/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package hexlet.code;

import org.junit.jupiter.api.BeforeAll;
import org.junit.jupiter.params.ParameterizedTest;
import org.junit.jupiter.params.provider.ValueSource;

import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Paths;

import static org.junit.jupiter.api.Assertions.assertEquals;

class AppTest {

    private static String expectedJson;
    private static String expectedStylish;
    private static String expectedPlain;
    private static String fileJson1;
    private static String fileJson2;
    private static String fileYml1;
    private static String fileYml2;

    @BeforeAll
    private static void init() throws IOException {
        fileJson1 = filePath("filepath1.json");
        fileJson2 = filePath("filepath2.json");
        fileYml1 = filePath("filepath1.yml");
        fileYml2 = filePath("filepath2.yml");

        String result1 = filePath("jsonTestResult.json");
        String result2 = filePath("stylishTestResult.txt");
        String result3 = filePath("plainTestResult.txt");

        expectedJson = getData(result1);
        expectedStylish = getData(result2);
        expectedPlain = getData(result3);
    }

    private static String filePath(String file) {
        return "./src/test/resources/" + file;
    }

    private static String getData(String path) throws IOException {
        return  Files.readString(Paths.get(path).toAbsolutePath().normalize());
    }

    @ParameterizedTest
    @ValueSource(strings = {"json", "yml"})
    void complexTest(String extension) throws Exception {
        String file1 = "./src/test/resources/" + "filepath1." + extension;
        String file2 = "./src/test/resources/" + "filepath2." + extension;

        String actual = Differ.generate(file1, file2);
        assertEquals(expectedStylish, actual);

        String actualStylish = Differ.generate(file1, file2, "stylish");
        assertEquals(expectedStylish, actualStylish);

        String actualPlain = Differ.generate(file1, file2, "plain");
        assertEquals(expectedPlain, actualPlain);

        String actualJson = Differ.generate(file1, file2, "json");
        assertEquals(expectedJson, actualJson);
    }
}
